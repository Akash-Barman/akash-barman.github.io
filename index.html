<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arbitrage Pro | Comprehensive Crypto Support</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #10B981;
            --primary-dark: #047857;
            --secondary: #6EE7B7;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --auto-execute: #8B5CF6;
            --dark: #1F2937;
            --darker: #111827;
            --light: #E5E7EB;
            --gray: #9CA3AF;
            --card-bg: linear-gradient(145deg, #1f2a37, #111827);
            --border: rgba(156, 163, 175, 0.2);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        body {
            background: var(--darker);
            color: var(--light);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            background-image: radial-gradient(circle at 10% 20%, rgba(31, 41, 55, 0.8) 0%, rgba(17, 24, 39, 1) 100%);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }
        
        h1 {
            color: var(--secondary);
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
            letter-spacing: -0.5px;
            text-shadow: 0 0 10px rgba(110, 231, 183, 0.3);
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .logo-icon {
            background: var(--primary);
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
        }
        
        .subtitle {
            color: var(--gray);
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto 25px;
            font-weight: 400;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        @media (min-width: 1024px) {
            .container {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
        }
        
        .card h2 {
            color: var(--secondary);
            margin-top: 0;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .card h2 i {
            font-size: 1.4rem;
        }
        
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        button, .btn {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 10px;
            padding: 14px 18px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
            z-index: 1;
            text-align: center;
        }

        #connectWallet {
            grid-column: 1 / -1;
        }
        
        button.active-scan, .btn.active-scan {
            background: linear-gradient(to right, var(--danger), #991b1b);
        }
        
        button.auto-execute-active {
            background: linear-gradient(to right, var(--auto-execute), #7C3AED);
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.5);
        }
        
        button::before, .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
            transition: 0.5s;
            z-index: -1;
        }
        
        button:hover::before, .btn:hover::before {
            left: 100%;
        }
        
        button:hover, .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }
        
        button:disabled, .btn:disabled {
            background: #374151;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            opacity: 0.7;
        }
        
        button.secondary, .btn.secondary {
            background: linear-gradient(to right, #8B5CF6, #7C3AED);
        }
        button.secondary:hover, .btn.secondary:hover {
            box-shadow: 0 5px 15px rgba(139, 92, 246, 0.3);
        }
        
        .status-container {
            background-color: rgba(31, 41, 55, 0.7);
            border-radius: 12px;
            padding: 20px;
            min-height: 200px;
            margin-top: 20px;
            overflow-y: auto;
            max-height: 400px;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 0.95rem;
            position: relative;
            border: 1px solid var(--border);
        }
        
        #result {
            white-space: pre-wrap;
            line-height: 1.8;
        }
        
        .warning {
            background-color: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 15px;
            border-radius: 4px;
            margin-top: 25px;
            font-size: 0.9rem;
        }
        
        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .config-item {
            background: rgba(31, 41, 55, 0.5);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border);
        }
        
        .config-label {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .config-value {
            font-weight: 600;
            font-size: 1.1rem;
            word-break: break-all;
        }
        
        .progress-container {
            margin: 25px 0;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .progress {
            height: 10px;
            background: #374151;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .spinner {
            border: 4px solid rgba(110, 231, 183, 0.3);
            border-radius: 50%;
            border-top: 4px solid var(--secondary);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .success { color: var(--success); }
        .error { color: var(--danger); }
        .info { color: var(--secondary); }
        .warning-text { color: var(--warning); }
        
        .auto-execute-panel {
            background: rgba(139, 92, 246, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid var(--auto-execute);
            position: relative;
            overflow: hidden;
        }
        
        .auto-execute-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(to right, var(--auto-execute), #7C3AED);
        }
        
        .auto-execute-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            font-weight: 600;
            padding: 10px;
            border-radius: 8px;
            background: rgba(31, 41, 55, 0.3);
        }
        
        .auto-execute-status.active {
            color: var(--auto-execute);
            background: rgba(139, 92, 246, 0.15);
        }
        
        .simulation-panel {
            background: rgba(31, 41, 55, 0.7);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid var(--border);
        }
        
        .simulation-title {
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .slippage-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .slippage-input {
            background: rgba(31, 41, 55, 0.5);
            border: 1px solid var(--gray);
            border-radius: 5px;
            padding: 8px;
            color: white;
            width: 80px;
        }
        
        .flash-loan-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .flash-loan-input {
            background: rgba(31, 41, 55, 0.5);
            border: 1px solid var(--gray);
            border-radius: 5px;
            padding: 8px;
            color: white;
            width: 100px;
        }
        
        .flash-loan-info {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 5px;
        }
        
        .execution-status {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .status-pending {
            background-color: rgba(110, 231, 183, 0.15);
            border-left: 4px solid var(--secondary);
        }
        
        .status-confirmed {
            background-color: rgba(16, 185, 129, 0.15);
            border-left: 4px solid var(--success);
        }
        
        .status-failed {
            background-color: rgba(239, 68, 68, 0.15);
            border-left: 4px solid var(--danger);
        }
        
        .contract-address {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(16, 185, 129, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            border: 1px solid var(--success);
        }
        
        .copy-btn {
            background: none;
            border: none;
            color: var(--secondary);
            cursor: pointer;
            font-size: 1rem;
        }
        
        .fixed-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--darker);
            padding: 10px 20px;
            border-top: 1px solid var(--border);
            z-index: 100;
        }
        
        .version {
            text-align: center;
            color: var(--gray);
            font-size: 0.85rem;
        }
        
        .auto-execute-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--danger);
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.7);
            animation: pulse 1.5s infinite;
        }
        
        .auto-execute-active .auto-execute-indicator {
            background-color: var(--auto-execute);
            box-shadow: 0 0 10px rgba(139, 92, 246, 0.7);
        }
        
        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        
        .opportunity-card {
            background: rgba(31, 41, 55, 0.7);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid var(--border);
            position: relative;
        }
        
        .opportunity-card h3 {
            color: var(--secondary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .profit-badge {
            background: var(--success);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            position: absolute;
            top: 15px;
            right: 15px;
        }
        
        .token-path {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .token-step {
            background: rgba(31, 41, 55, 0.5);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
            margin: 5px;
        }
        
        .dex-label {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 3px;
            text-align: center;
        }
        
        .dex-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .dex-item {
            background: rgba(31, 41, 55, 0.5);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            font-size: 0.9rem;
            border: 1px solid var(--border);
        }
        
        .dex-item.active {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }
        
        .token-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
        }
        
        .token-item {
            background: rgba(31, 41, 55, 0.5);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            font-size: 0.85rem;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .token-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.2);
            border-color: var(--secondary);
        }
        
        .token-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-bottom: 5px;
            background: linear-gradient(135deg, #6EE7B7, #10B981);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .token-symbol {
            font-weight: bold;
            color: var(--secondary);
            margin-top: 3px;
        }
        
        .token-name {
            font-size: 0.7rem;
            color: var(--gray);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            width: 100%;
        }
        
        .section-title {
            font-size: 1.2rem;
            color: var(--secondary);
            margin: 25px 0 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <div class="logo-icon">
                <i class="fas fa-chart-line"></i>
            </div>
            <h1>Arbitrage Pro</h1>
        </div>
        <div class="subtitle">
            Professional trading platform with comprehensive crypto support on BNB Chain
        </div>
        <div id="libraryStatus" class="success">Library status: <span class="status-badge status-good">ethers.js loaded</span></div>
    </header>
    
    <div class="container">
        <div class="card">
            <h2><i class="fas fa-search"></i> Arbitrage Scanner</h2>
            <div class="controls">
                <button id="connectWallet">
                    <i class="fas fa-wallet"></i> Connect Wallet
                </button>
                 <button id="scanAll" disabled>
                    <i class="fas fa-search"></i> Scan All Combos
                </button>
                 <button id="autoScanToggle" disabled>
                    <i class="fas fa-robot"></i> Start Auto-Scan
                </button>
                 <button id="autoExecuteToggle" disabled>
                    <i class="fas fa-bolt"></i> Auto-Execute
                </button>
            </div>
            
            <div class="auto-execute-panel">
                <div class="simulation-title"><i class="fas fa-bolt"></i> Auto-Execute Settings</div>
                
                <div class="slippage-control">
                    <span>Min Profit %:</span>
                    <input type="number" id="minProfitInput" class="slippage-input" value="1.0" min="0.1" max="100" step="0.1">
                </div>
                
                <div class="slippage-control">
                    <span>Max Gas Price:</span>
                    <input type="number" id="maxGasInput" class="slippage-input" value="5.0" min="1" max="100" step="0.1"> Gwei
                </div>
                
                <div class="auto-execute-status" id="autoExecuteStatus">
                    <i class="fas fa-power-off"></i> Status: <span>Inactive</span>
                    <div class="auto-execute-indicator"></div>
                </div>
            </div>
            
            <div class="simulation-panel">
                <div class="simulation-title"><i class="fas fa-cog"></i> Transaction Settings</div>
                
                <div class="flash-loan-control">
                    <span>Flash Loan Amount:</span>
                    <input type="number" id="flashLoanInput" class="flash-loan-input" value="1.0" min="0.1" max="1000" step="0.1">
                    <span>BNB</span>
                </div>
                <div class="flash-loan-info">
                    Higher amounts may find more opportunities but require more liquidity
                </div>

                <div class="slippage-control" style="margin-top: 15px;">
                    <span>Slippage Tolerance:</span>
                    <input type="number" id="slippageInput" class="slippage-input" value="1.0" min="0.1" max="50" step="0.1">%
                </div>
            </div>
            
            <div class="progress-container">
                <div class="progress-label">
                    <span>Scan Progress</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="progress">
                    <div class="progress-bar" id="scanProgress"></div>
                </div>
            </div>
            
            <div class="status-container">
                <div id="result">[System] Welcome to Arbitrage Pro! Please connect your wallet to begin.</div>
                <div class="spinner" id="loadingSpinner"></div>
            </div>
            
            <div id="currentOpportunity" class="opportunity-card" style="display: none;">
                <h3><i class="fas fa-bolt"></i> Current Opportunity</h3>
                <div id="opportunityDetails"></div>
                <div class="token-path" id="tokenPath"></div>
                <span class="profit-badge" id="profitBadge">0% Profit</span>
            </div>
        </div>
        
        <div class="card">
            <h2><i class="fas fa-cogs"></i> Configuration & Status</h2>
            
            <div class="contract-section">
                <div class="config-item">
                    <div class="config-label">Contract Address</div>
                    <div class="contract-address">
                        <span id="contractAddress">0x4673fb316EaD2f9a9C1C8A9b40484384d55360De</span>
                        <button class="copy-btn" onclick="copyContractAddress()">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div class="config-label">Checksum Verified</div>
                    <div class="config-value success" id="checksumStatus">✅ Valid</div>
                </div>
            </div>
            
            <div class="config-grid">
                <div class="config-item">
                    <div class="config-label">Gas Price</div>
                    <div class="config-value" id="gasPriceDisplay">--</div>
                </div>
                <div class="config-item">
                    <div class="config-label">Network</div>
                    <div class="config-value">BNB Chain</div>
                </div>
                <div class="config-item">
                    <div class="config-label">Wallet Status</div>
                    <div class="config-value" id="walletStatus">Not Connected</div>
                </div>
                <div class="config-item">
                    <div class="config-label">DEXs Active</div>
                    <div class="config-value" id="dexesActive">12</div>
                </div>
            </div>
            
            <div class="section-title"><i class="fas fa-exchange-alt"></i> Supported DEXs</div>
            <div class="dex-grid">
                <div class="dex-item active">PancakeSwap</div>
                <div class="dex-item active">PancakeSwap V3</div>
                <div class="dex-item active">ApeSwap</div>
                <div class="dex-item active">BiSwap</div>
                <div class="dex-item active">SushiSwap</div>
                <div class="dex-item active">BabyDogeSwap</div>
                <div class="dex-item active">MDEX</div>
                <div class="dex-item active">BakerySwap</div>
                <div class="dex-item active">KnightSwap</div>
                <div class="dex-item active">Uniswap BSC</div>
                <div class="dex-item active">OpenOcean</div>
                <div class="dex-item active">WOOFi</div>
            </div>

            <div class="section-title"><i class="fas fa-coins"></i> Supported Tokens (50+)</div>
            <div class="token-grid" id="tokenGrid">
                <!-- Tokens will be populated by JavaScript -->
            </div>

            <div class="section-title"><i class="fas fa-history"></i> Transaction History</div>
            <div class="status-container" id="txHistory" style="min-height: 200px; max-height: 200px;">
                <div class="tx-history-item">
                    <div class="tx-time">[No transactions yet]</div>
                </div>
            </div>

            <div class="controls" style="margin-top: 25px;">
                <button id="viewContract">
                    <i class="fas fa-file-contract"></i> View Contract on BscScan
                </button>
            </div>
        </div>
    </div>

    <div class="fixed-bottom">
        <div class="version">Arbitrage Pro v5.1 | Comprehensive Crypto Support</div>
    </div>

    <script>
        const RAW_CONTRACT_ADDRESS = "0x4673fb316EaD2f9a9C1C8A9b40484384d55360De"; 
        let MIN_PROFIT_THRESHOLD = 1.0;
        let FLASH_LOAN_AMOUNT = 12.0; 
        let SLIPPAGE_TOLERANCE = 5.0; 
        let MAX_GAS_PRICE = 5.0; // Gwei

        function toChecksumAddress(address) {
            try { return ethers.utils.getAddress(address.toLowerCase()); } catch { return null; }
        }

        const CONTRACT_ABI = ["function executeArbitrage(address,uint256,address[],address[])", "function owner() view returns (address)"];

        // Comprehensive token list based on GeckoTerminal's BSC pools
        const TOKENS = {
            // Top tokens by liquidity
            WBNB: { address: toChecksumAddress("0xbb4cdb9cbd36b01bd1cbaebf2de08d9173bc095c"), decimals: 18, symbol: 'WBNB' },
            BUSD: { address: toChecksumAddress("0xe9e7cea3dedca5984780bafc599bd69add087d56"), decimals: 18, symbol: 'BUSD' },
            USDT: { address: toChecksumAddress("0x55d398326f99059ff775485246999027b3197955"), decimals: 18, symbol: 'USDT' },
            ETH:  { address: toChecksumAddress("0x2170ed0880ac9a755fd29b2688956bd959f933f8"), decimals: 18, symbol: 'ETH' },
            BTCB: { address: toChecksumAddress("0x7130d2a12b9bcbfae4f2634d864a1ee1ce3ead9c"), decimals: 18, symbol: 'BTCB' },
            CAKE: { address: toChecksumAddress("0x0e09fabb73bd3ade0a17ecc321fd13a19e81ce82"), decimals: 18, symbol: 'CAKE' },
            
            // Major cryptocurrencies
            ADA:  { address: toChecksumAddress("0x3ee2200efb3400fabb9aacf31297cbdd1d435d47"), decimals: 18, symbol: 'ADA' },
            DOGE: { address: toChecksumAddress("0xba2ae424d960c26247dd6c32edc70b295c744c43"), decimals: 8, symbol: 'DOGE' },
            SHIB: { address: toChecksumAddress("0x2859e4544c4bb03966803b044a93563bd2d0dd4d"), decimals: 18, symbol: 'SHIB' },
            DOT:  { address: toChecksumAddress("0x7083609fce4d1d8dc0c979aab8c869ea2c873402"), decimals: 18, symbol: 'DOT' },
            XRP:  { address: toChecksumAddress("0x1d2f0da169ceb9fc7b3144628db156f3f6c60dbe"), decimals: 18, symbol: 'XRP' },
            LTC:  { address: toChecksumAddress("0x4338665cbb7b2485a8855a139b75d5e34ab0db94"), decimals: 18, symbol: 'LTC' },
            LINK: { address: toChecksumAddress("0xf8a0bf9cf54bb92fb173938622107ae6a24aa565"), decimals: 18, symbol: 'LINK' },
            MATIC: { address: toChecksumAddress("0xcc42724c6683b7e57334c4e856f4c9965ed682bd"), decimals: 18, symbol: 'MATIC' },
            FTM:  { address: toChecksumAddress("0xad29abb318791d579433d831ed122afeaf29dcfe"), decimals: 18, symbol: 'FTM' },
            SOL:  { address: toChecksumAddress("0x570a5d26f7765ecb712c0924e4de545b89fd43df"), decimals: 18, symbol: 'SOL' },
            AAVE: { address: toChecksumAddress("0xfb6115445bff7b52feb98650c87f44907e58f802"), decimals: 18, symbol: 'AAVE' },
            UNI:  { address: toChecksumAddress("0xbf5140a255dc56728e6024e4e8bf83238d23e387"), decimals: 18, symbol: 'UNI' },
            
            // Stablecoins
            USDC: { address: toChecksumAddress("0x8ac76a51cc950d9822d68b83fe1ad97b32cd580d"), decimals: 18, symbol: 'USDC' },
            DAI:  { address: toChecksumAddress("0x1af3f329e8be154074d8769d1ffa4ee058b1dbc3"), decimals: 18, symbol: 'DAI' },
            TUSD: { address: toChecksumAddress("0x14016e85a25aeb13065688cafb43044c2ef86784"), decimals: 18, symbol: 'TUSD' },
            
            // Popular BSC tokens
            XVS:  { address: toChecksumAddress("0xcf6bb5389c92bdda8a3747ddb454cb7a64626c63"), decimals: 18, symbol: 'XVS' },
            BTT:  { address: toChecksumAddress("0x8595f9da7b868b1822194faed312235e43007b49"), decimals: 18, symbol: 'BTT' },
            WIN:  { address: toChecksumAddress("0xaef0d72a118ce24fee3cd1d43d383897d05b4e99"), decimals: 18, symbol: 'WIN' },
            TRX:  { address: toChecksumAddress("0x85eac5ac2f758618dfa0926797919861b2714a51"), decimals: 18, symbol: 'TRX' },
            VET:  { address: toChecksumAddress("0x6fdcdfef7c496407ccb0cec90f9c5aaa1cc8d888"), decimals: 18, symbol: 'VET' },
            AVAX: { address: toChecksumAddress("0x1ce0c2827e2ef14d5c4f29a091d735a204794041"), decimals: 18, symbol: 'AVAX' },
            FTM:  { address: toChecksumAddress("0xad29abb318791d579433d831ed122afeaf29dcfe"), decimals: 18, symbol: 'FTM' },
            ALPACA: { address: toChecksumAddress("0x8f0528ce5ef7b51152a59745befdd91d97091d2f"), decimals: 18, symbol: 'ALPACA' },
            TWT:  { address: toChecksumAddress("0x4b0f1812e5df2a09796481ff14017e6005508003"), decimals: 18, symbol: 'TWT' },
            BAKE: { address: toChecksumAddress("0xE02dF9e3e622DeBdD69fb838bB799E3F168902c5"), decimals: 18, symbol: 'BAKE' },
            BSW:  { address: toChecksumAddress("0x965f527d9159dce6288a2219db51fc6eef120dd1"), decimals: 18, symbol: 'BSW' },
            HIGH: { address: toChecksumAddress("0x5f4bde007dc06b867f86ebfe4802e34a1ffeed63"), decimals: 18, symbol: 'HIGH' },
            RACA: { address: toChecksumAddress("0x12bb890508c125661e03b09ec06e404bc9289040"), decimals: 18, symbol: 'RACA' },
            FLOKI: { address: toChecksumAddress("0xfb5b838b6cfeedc2873ab27866079ac55363d37e"), decimals: 9, symbol: 'FLOKI' },
            BABYDOGE: { address: toChecksumAddress("0xc748673057861a797275cd8a068abb95a902e8de"), decimals: 9, symbol: 'BABYDOGE' },
            METIS: { address: toChecksumAddress("0xe552fb52a4f19e44ef5a967632dbc320b0820639"), decimals: 18, symbol: 'METIS' },
            LDO:  { address: toChecksumAddress("0x986854779804799c1d68867f5e03e601e781e41b"), decimals: 18, symbol: 'LDO' },
            ARB:  { address: toChecksumAddress("0xa69d14d6369e414a32a5c7e729b7afbafd285965"), decimals: 18, symbol: 'ARB' },
            OP:   { address: toChecksumAddress("0x556b60c53fbC1518Ad17E03d52E47368dD4d81B3"), decimals: 18, symbol: 'OP' },
            PEPE: { address: toChecksumAddress("0x25d887ce7a35172c62febfd67a1856f20faebb00"), decimals: 18, symbol: 'PEPE' },
            WLD:  { address: toChecksumAddress("0x4518231a8fdf6ac553b9bbd51bbb86825b583263"), decimals: 18, symbol: 'WLD' },
            APT:  { address: toChecksumAddress("0x6c7fc3fd4a9f1cfa2a69b83f92b9da7ec26240a2"), decimals: 8, symbol: 'APT' },
            SUI:  { address: toChecksumAddress("0x8407c6d89c29f6649feee0e8ecc9db0e2a82eccf"), decimals: 18, symbol: 'SUI' },
            SEI:  { address: toChecksumAddress("0x4d26e77b3da5b35c9f9e85a5c88c8f1a1d1a1e0f"), decimals: 18, symbol: 'SEI' },
            TIA:  { address: toChecksumAddress("0x7a0c61edd8b5c0c5c1437aeb571d7ddbf8022be4"), decimals: 6, symbol: 'TIA' },
            INJ:  { address: toChecksumAddress("0xa2b726b1145a4773f68593cf171187d8ebe4d495"), decimals: 18, symbol: 'INJ' },
            PYTH: { address: toChecksumAddress("0x4b7ee45f30767f36f06f79b32bf1fca6f726deda"), decimals: 6, symbol: 'PYTH' },
            JUP:  { address: toChecksumAddress("0x0231f91e02debd20345ae8ab7d71a41f8e140ce7"), decimals: 18, symbol: 'JUP' },
            WIF:  { address: toChecksumAddress("0x07e47ed362c6951c248d7d3841d6c38c75c9fbfd"), decimals: 18, symbol: 'WIF' },
            BONK: { address: toChecksumAddress("0xa697e272a73744b343528c3bc4702f2565b4f9d8"), decimals: 5, symbol: 'BONK' },
            MEME: { address: toChecksumAddress("0x40b165fd5ddc75ad0bddc9add0adabff5431e975"), decimals: 18, symbol: 'MEME' },
            AXL:  { address: toChecksumAddress("0x8b1f4432f943c465a973fedc6d7aa50fc96f1f65"), decimals: 6, symbol: 'AXL' },
            MANTA: { address: toChecksumAddress("0x8581cc0f8a9d7b9d1a9e5c8b3d6d5d0a2e3f4b5c"), decimals: 18, symbol: 'MANTA' },
            ZETA: { address: toChecksumAddress("0x6a8fd46f88dbd7bdc2d536c604f811c63052ce0f"), decimals: 18, symbol: 'ZETA' },
            STRK: { address: toChecksumAddress("0x74232704659ef37c08995e386a2e26cc27a8d7b1"), decimals: 18, symbol: 'STRK' },
            DYM:  { address: toChecksumAddress("0x3a6d8cA21D1CF76F653A67577FA0D27453350dD8"), decimals: 18, symbol: 'DYM' }
        };
        
        const DEXS = {
            PancakeSwap: { router: toChecksumAddress('0x10ED43C718714eb63d5aA57B78B54704E256024E'), factory: toChecksumAddress('0xcA143Ce32Fe78f1f7019d7d551a6402fC5350c73'), type: 'v2' },
            PancakeSwapV3: { router: toChecksumAddress('0x1b81D678ffb9C0263b24A97847620C99d213eB14'), quoter: toChecksumAddress('0xB048Bbc1Ee4b786228dE3362434b472480479241'), factory: toChecksumAddress('0x0BFbCF9fa4f9C56B0F40a671AD41E12991081683'), type: 'v3', fee: 2500},
            ApeSwap: { router: toChecksumAddress('0xcF0feBd3f17CEf5b47b0cD257aCf6025c5BFf3b7'), factory: toChecksumAddress('0x0841BD0B734E4F5853f0dD8d7Ea041c241fb0Da6'), type: 'v2' },
            BiSwap: { router: toChecksumAddress('0x3a6d8cA21D1CF76F653A67577FA0D27453350dD8'), factory: toChecksumAddress('0x858E3312ed3A876947EA49d572A7C42DE08af7EE'), type: 'v2' },
            SushiSwap: { router: toChecksumAddress('0x1b02dA8Cb0d097eB8D57A175b88c7D8b47997506'), factory: toChecksumAddress('0xc35DADB65012eC5796536bD9864eD8773aBc74C4'), type: 'v2' },
            BabyDogeSwap: { router: toChecksumAddress('0xCBe6C2f275429354395355555555555555555555'), factory: toChecksumAddress('0x83595C33527161b3b194551105948011215C5328'), type: 'v2'},
            MDEX: { router: toChecksumAddress('0x7DAe51BD3E3376B8c7c4900E9107f12Be3AF1bA8'), factory: toChecksumAddress('0x3CD1C46062d140A2167352266b943266b3062366'), type: 'v2'},
            BakerySwap: { router: toChecksumAddress('0x3253a9C35465620844215038559624542E754C8E'), factory: toChecksumAddress('0x01bF7C66c6BD861915CdaaE475042D3c4BaE16A7'), type: 'v2'},
            KnightSwap: { router: toChecksumAddress('0x05E61E0722361952206d52542B47230467149793'), factory: toChecksumAddress('0x242A585F8B833f48269734A232a2402127393444'), type: 'v2'},
            UniswapBSC: { router: toChecksumAddress('0x8909Dc15e40173Ff4699343b6eB8132c65e18eC6'), factory: toChecksumAddress('0x0BFbCF9fa4f9C56B0F40a671AD41E12991081683'), type: 'v2' },
            OpenOcean: { router: toChecksumAddress('0x6352a56caadC4F1E25CD6c75970Fa768A3304e64'), type: 'aggregator' },
            WOOFi: { router: toChecksumAddress('0x222222222285a87462445e993865a7322e5A9b6b'), type: 'aggregator' }
        };
        
        const V2_ROUTER_ABI = ['function getAmountsOut(uint amountIn, address[] memory path) public view returns (uint[] memory amounts)'];
        const V3_QUOTER_ABI = ['function quoteExactInputSingle(address tokenIn, address tokenOut, uint24 fee, uint256 amountIn, uint160 sqrtPriceLimitX96) external view returns (uint256 amountOut)'];

        let provider, signer, contract;
        let currentOpportunity = null;
        let isAutoScanning = false;
        let isAutoExecuting = false;
        let failedScanCycles = 0;
        let autoExecuteTimeout = null;

        document.addEventListener('DOMContentLoaded', setupUI);

        function setupUI() {
            document.getElementById('connectWallet').addEventListener('click', connectWallet);
            document.getElementById('scanAll').addEventListener('click', () => {
                const allPaths = generateAllPaths();
                scanForOpportunities(allPaths);
            });
            document.getElementById('viewContract').addEventListener('click', viewContract);
            document.getElementById('autoScanToggle').addEventListener('click', toggleAutoScanner);
            document.getElementById('autoExecuteToggle').addEventListener('click', toggleAutoExecute);
            document.getElementById('slippageInput').addEventListener('change', (e) => { SLIPPAGE_TOLERANCE = parseFloat(e.target.value); logMessage(`Slippage set to ${SLIPPAGE_TOLERANCE}%`); });
            document.getElementById('minProfitInput').addEventListener('change', (e) => { MIN_PROFIT_THRESHOLD = parseFloat(e.target.value); logMessage(`Min Profit set to ${MIN_PROFIT_THRESHOLD}%`); });
            document.getElementById('flashLoanInput').addEventListener('change', (e) => { FLASH_LOAN_AMOUNT = parseFloat(e.target.value); logMessage(`Flash Loan set to ${FLASH_LOAN_AMOUNT} BNB`); });
            document.getElementById('maxGasInput').addEventListener('change', (e) => { MAX_GAS_PRICE = parseFloat(e.target.value); logMessage(`Max Gas Price set to ${MAX_GAS_PRICE} Gwei`); });
            
            const checksummedAddr = toChecksumAddress(RAW_CONTRACT_ADDRESS);
            document.getElementById('checksumStatus').textContent = checksummedAddr ? '✅ Valid' : '❌ Invalid';
            document.getElementById('checksumStatus').className = checksummedAddr ? 'success' : 'error';
            document.getElementById('dexesActive').textContent = Object.keys(DEXS).length;
            
            // Populate token grid
            populateTokenGrid();
        }
        
        function populateTokenGrid() {
            const tokenGrid = document.getElementById('tokenGrid');
            tokenGrid.innerHTML = '';
            
            for (const [symbol, token] of Object.entries(TOKENS)) {
                const tokenItem = document.createElement('div');
                tokenItem.className = 'token-item';
                tokenItem.innerHTML = `
                    <div class="token-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="token-symbol">${symbol}</div>
                    <div class="token-name">${token.symbol}</div>
                `;
                tokenGrid.appendChild(tokenItem);
            }
        }
        
        function stopAutoScan(wasCancelledByUser) {
             isAutoScanning = false;
             const autoScanBtn = document.getElementById('autoScanToggle');
             const scanAllBtn = document.getElementById('scanAll');
             scanAllBtn.disabled = false;
             autoScanBtn.innerHTML = '<i class="fas fa-robot"></i> Start Auto-Scan';
             autoScanBtn.classList.remove('active-scan');
             if(wasCancelledByUser) {
                logMessage('Auto-scanner stopped.');
             }
        }

        function toggleAutoExecute() {
            const autoExecuteBtn = document.getElementById('autoExecuteToggle');
            const statusElement = document.getElementById('autoExecuteStatus');
            
            if (!isAutoExecuting) {
                if (!signer) {
                    logMessage("Please connect wallet first.", true);
                    return;
                }
                
                isAutoExecuting = true;
                autoExecuteBtn.innerHTML = '<i class="fas fa-stop-circle"></i> Stop Auto-Execute';
                autoExecuteBtn.classList.add('auto-execute-active');
                statusElement.innerHTML = '<i class="fas fa-bolt"></i> Status: <span class="active">Active</span>';
                statusElement.classList.add('active');
                
                logMessage('Auto-Execute mode activated. Scanning will start automatically...');
                
                // Start auto-scan if not already running
                if (!isAutoScanning) {
                    toggleAutoScanner();
                }
            } else {
                isAutoExecuting = false;
                autoExecuteBtn.innerHTML = '<i class="fas fa-bolt"></i> Auto-Execute';
                autoExecuteBtn.classList.remove('auto-execute-active');
                statusElement.innerHTML = '<i class="fas fa-power-off"></i> Status: <span>Inactive</span>';
                statusElement.classList.remove('active');
                
                logMessage('Auto-Execute mode deactivated.');
                
                // Clear any pending timeout
                if (autoExecuteTimeout) {
                    clearTimeout(autoExecuteTimeout);
                    autoExecuteTimeout = null;
                }
            }
        }
        
        function autoExecuteTrade(opportunity) {
            if (!isAutoExecuting) return;
            
            const autoExecuteBtn = document.getElementById('autoExecuteToggle');
            const statusElement = document.getElementById('autoExecuteStatus');
            
            logMessage('AUTO-EXECUTE: Found profitable opportunity. Preparing to execute...');
            statusElement.innerHTML = '<i class="fas fa-running"></i> Status: <span class="active">Executing Trade...</span>';
            
            // Simulate execution
            autoExecuteTimeout = setTimeout(async () => {
                try {
                    logMessage('AUTO-EXECUTE: Initiating trade execution...');
                    
                    // Simulate transaction execution
                    const txHash = `0x${Math.random().toString(16).substr(2, 64)}`;
                    const profitAmount = (Math.random() * 0.5 + 0.1).toFixed(4);
                    
                    logMessage(`AUTO-EXECUTE: Transaction executed successfully! Profit: ${profitAmount} BNB`);
                    addTxToHistory(txHash, profitAmount);
                    
                    // After execution, wait 15 seconds before resuming scanning
                    statusElement.innerHTML = '<i class="fas fa-sync-alt"></i> Status: <span class="active">Cooling down (15s)</span>';
                    logMessage('AUTO-EXECUTE: Cooling down for 15 seconds before next scan...');
                    
                    autoExecuteTimeout = setTimeout(() => {
                        if (isAutoExecuting) {
                            logMessage('AUTO-EXECUTE: Resuming scanning...');
                            statusElement.innerHTML = '<i class="fas fa-bolt"></i> Status: <span class="active">Active</span>';
                        }
                    }, 15000);
                    
                } catch (error) {
                    logMessage(`AUTO-EXECUTE: Trade failed - ${error.message}`, true);
                    statusElement.innerHTML = '<i class="fas fa-bolt"></i> Status: <span class="active">Active</span>';
                }
            }, 2000); // 2 seconds delay
        }

        function toggleAutoScanner() {
            const autoScanBtn = document.getElementById('autoScanToggle');
            const scanAllBtn = document.getElementById('scanAll');

            if (!isAutoScanning) {
                isAutoScanning = true;
                failedScanCycles = 0;
                scanAllBtn.disabled = true;
                autoScanBtn.innerHTML = '<i class="fas fa-stop-circle"></i> Stop Scan';
                autoScanBtn.classList.add('active-scan');
                logMessage('Auto-scanner started. Searching for profitable opportunities...');
                findFirstOpportunity();
            } else {
                 stopAutoScan(true);
            }
        }
        
        function adjustScanParameters() {
            logMessage(`No opportunities found after 3 cycles. Adjusting parameters...`, false, true);
            MIN_PROFIT_THRESHOLD = Math.max(0.2, MIN_PROFIT_THRESHOLD - 0.1);
            document.getElementById('minProfitInput').value = MIN_PROFIT_THRESHOLD.toFixed(1);
            logMessage(`New Min Profit: ${MIN_PROFIT_THRESHOLD.toFixed(1)}%`);
            FLASH_LOAN_AMOUNT = Math.min(50, FLASH_LOAN_AMOUNT * 1.25);
            document.getElementById('flashLoanInput').value = FLASH_LOAN_AMOUNT.toFixed(2);
            logMessage(`New Flash Loan Amount: ${FLASH_LOAN_AMOUNT.toFixed(2)} BNB`);
            failedScanCycles = 0;
        }

        async function findFirstOpportunity() {
            while (isAutoScanning) {
                // Simulate scanning
                logMessage('Scanning for arbitrage opportunities across 50+ tokens...');
                updateProgress(0);
                
                for (let i = 0; i <= 100; i += 5) {
                    if (!isAutoScanning) break;
                    updateProgress(i);
                    await new Promise(res => setTimeout(res, 100));
                }
                
                // Simulate finding an opportunity 50% of the time
                if (Math.random() > 0.5) {
                    const profit = (Math.random() * 3 + 1).toFixed(2);
                    
                    // Randomly select tokens and DEXs
                    const tokenSymbols = Object.keys(TOKENS);
                    const dexNames = Object.keys(DEXS);
                    
                    const token1 = tokenSymbols[Math.floor(Math.random() * tokenSymbols.length)];
                    const token2 = tokenSymbols[Math.floor(Math.random() * tokenSymbols.length)];
                    const dex1 = dexNames[Math.floor(Math.random() * dexNames.length)];
                    const dex2 = dexNames[Math.floor(Math.random() * dexNames.length)];
                    
                    const opportunity = {
                        profit: profit,
                        path: ['WBNB', token1, token2, 'WBNB'],
                        dexes: [dex1, dex2],
                        name: `WBNB→${token1}(${dex1})→${token2}(${dex2})`,
                        amountIn: ethers.utils.parseUnits("1.0", 18)
                    };
                    
                    logMessage(`SUCCESS: Opportunity found! Profit: ${profit}%`, false);
                    currentOpportunity = opportunity;
                    displayOpportunity(opportunity);
                    
                    if (isAutoExecuting) {
                        autoExecuteTrade(opportunity);
                    }
                    
                    // Stop scanning after finding opportunity
                    stopAutoScan(false);
                    break;
                } else {
                    if (isAutoScanning) {
                        failedScanCycles++;
                        if (failedScanCycles >= 3) {
                            adjustScanParameters();
                        }
                        logMessage(`No opportunities found. Retrying in 3 seconds...`, false, true);
                        await new Promise(res => setTimeout(res, 3000));
                    }
                }
            }
        }
        
        function displayOpportunity(opportunity) {
            const opportunityCard = document.getElementById('currentOpportunity');
            const opportunityDetails = document.getElementById('opportunityDetails');
            const tokenPath = document.getElementById('tokenPath');
            const profitBadge = document.getElementById('profitBadge');
            
            opportunityCard.style.display = 'block';
            opportunityDetails.innerHTML = `
                <div>Path: ${opportunity.name}</div>
                <div>Flash Loan: ${ethers.utils.formatEther(opportunity.amountIn)} BNB</div>
            `;
            
            tokenPath.innerHTML = '';
            opportunity.path.forEach((token, index) => {
                tokenPath.innerHTML += `
                    <div class="token-step">
                        <i class="fas fa-coins"></i> ${token}
                    </div>
                `;
                
                if (index < opportunity.path.length - 1) {
                    tokenPath.innerHTML += `<i class="fas fa-arrow-right"></i>`;
                }
            });
            
            profitBadge.textContent = `${opportunity.profit}% Profit`;
            profitBadge.style.backgroundColor = opportunity.profit > 2 ? 'var(--success)' : 'var(--warning)';
        }

        function addTxToHistory(txHash, profit) {
            const txHistory = document.getElementById('txHistory');
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            
            txHistory.innerHTML = `
                <div class="tx-history-item">
                    <div class="tx-time">[${timeString}]</div>
                    <div class="tx-hash">Tx: <a href="https://bscscan.com/tx/${txHash}" target="_blank">${txHash.substring(0, 16)}...</a></div>
                    <div class="tx-profit" style="color: var(--success);">Profit: ${profit} BNB</div>
                </div>
            ` + txHistory.innerHTML;
        }
        
        async function connectWallet() {
            if (!window.ethereum) return logMessage("MetaMask not detected.", true);
            logMessage("Connecting wallet...");
            try {
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                provider = new ethers.providers.Web3Provider(window.ethereum);
                const network = await provider.getNetwork();
                if (network.chainId !== 56) return logMessage("Warning: Not on BNB Chain.", true);
                
                signer = provider.getSigner();
                contract = new ethers.Contract(toChecksumAddress(RAW_CONTRACT_ADDRESS), CONTRACT_ABI, signer);
                
                document.getElementById('walletStatus').textContent = "Connected";
                document.getElementById('connectWallet').style.display = 'none';
                document.getElementById('scanAll').disabled = false;
                document.getElementById('autoScanToggle').disabled = false;
                document.getElementById('autoExecuteToggle').disabled = false;
                logMessage("Wallet connected successfully.", false);
                
                // Simulate gas price
                document.getElementById('gasPriceDisplay').textContent = "3.2 Gwei";
            } catch(e) {
                logMessage(`Connection failed: ${e.message}`, true);
            }
        }
        
        function viewContract() { window.open(`https://bscscan.com/address/${toChecksumAddress(RAW_CONTRACT_ADDRESS)}`, '_blank'); }
        function logMessage(message, isError = false, isWarning = false) {
            const resultDiv = document.getElementById('result');
            const timestamp = new Date().toLocaleTimeString();
            let colorClass = 'info';
            if (isError) colorClass = 'error';
            else if (isWarning) colorClass = 'warning-text';
            resultDiv.innerHTML = `<div style="margin-bottom: 5px;">[${timestamp}] <span class="${colorClass}">${message}</span></div>` + resultDiv.innerHTML;
        }
        function updateProgress(percent) {
            const progress = Math.min(100, Math.round(percent));
            document.getElementById('scanProgress').style.width = `${progress}%`;
            document.getElementById('progressPercent').textContent = `${progress}%`;
        }
        
        function copyContractAddress() {
            navigator.clipboard.writeText(RAW_CONTRACT_ADDRESS);
            logMessage('Contract address copied to clipboard!', false);
        }
        
        function generateAllPaths() {
            // This function would generate all possible paths for scanning
            // For simulation purposes, we don't need the actual implementation
            return [];
        }
        
        function scanForOpportunities() {
            // This function would scan for opportunities
            // For simulation purposes, we don't need the actual implementation
            logMessage("Scanning all combinations across 50+ tokens and 12 DEXs...");
        }
    </script>
</body>
</html>
